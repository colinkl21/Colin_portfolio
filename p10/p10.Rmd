---
title: "Portfolio 10 logistic regression and path model"
author: "Colin Li"
date: "5/4/2023"
output: github_document
---

My last portfolio. I thought I wanted to do something epic like rayshader. But I don't have the appropriate data. And I feel like even if I made it, I won't be able to use the code everyday because something like that is not very common and it would end up being less useful. So I decided to do logistic regression and path model for an upcoming project I'm planning to submit to SPSP. 

```{r}
library(lme4)
library(ggstatsplot)
library(correlation)
library(see)
library(tidyverse)
library(tidygraph)
library(ggplot2)
library(ggsci)
library(GGally)
library(sjPlot)
library(lavaan)
library(semPlot)
library(psych)
library(sjmisc)
library(sjlabelled)
library(car)

load(file='C:/Users/Colin/Downloads/ICPSR_37166-V2 (1)/ICPSR_37166/DS0007/37166-0007-Data.rda')



W1<-correlation(da37166.0007[c("W1EVERYDAY", "W1SOCSUPPORT", "W1CONNECTEDNESS", "W1INTERNALIZED", "W1FELTSTIGMA", "W1IDCENTRAL")], use = "pairwise")

summary(W1)


W2<-correlation(da37166.0007[c("W2EVERYDAY", "W2SOCSUPPORT", "W2CONNECTEDNESS", "W2INTERNALIZED", "W2FELTSTIGMA", "W2IDCENTRAL")], use = "pairwise")

summary(W2)

W3<-correlation(da37166.0007[c("W3EVERYDAY", "W3SOCSUPPORT", "W3CONNECTEDNESS", "W3INTERNALIZED", "W3FELTSTIGMA", "W3IDCENTRAL")], use = "pairwise")

summary(W3)

plot(summary(correlation(data = da37166.0007[c("W1EVERYDAY", "W1SOCSUPPORT", "W1CONNECTEDNESS", "W1INTERNALIZED", "W1FELTSTIGMA", "W1IDCENTRAL")], rename = c("Everyday Disrimination", "Social Support", "Community Connectedness", "Internalized Homophobia", "Felt Stigma", "Identity Centrality")
))) + theme_classic() + theme(axis.text.x=element_text(vjust = 0.5, angle = 15), plot.title = element_text(face = "bold", hjust = 0.5)) + labs(title = "Wave 1 Predictor Correlations") + scale_fill_gradient2(low = "#E64B35FF",
  mid = "white",
  high = "#4DBBD5FF") + guides(fill = FALSE)

plot(summary(correlation(data = da37166.0007[c("W2EVERYDAY", "W2SOCSUPPORT", "W2CONNECTEDNESS", "W2INTERNALIZED", "W2FELTSTIGMA", "W2IDCENTRAL")], rename = c("Everyday Disrimination", "Social Support", "Community Connectedness", "Internalized Homophobia", "Felt Stigma", "Identity Centrality")
))) + theme_classic() + theme(axis.text.x=element_text(vjust = 0.5, angle = 15), plot.title = element_text(face = "bold", hjust = 0.5)) + labs(title = "Wave 2 Predictor Correlations") + scale_fill_gradient2(low = "#E64B35FF",
  mid = "white",
  high = "#4DBBD5FF") + guides(fill = FALSE)

plot(summary(correlation(data = da37166.0007[c("W3EVERYDAY", "W3SOCSUPPORT", "W3CONNECTEDNESS", "W3INTERNALIZED", "W3FELTSTIGMA", "W3IDCENTRAL")], rename = c("Everyday Disrimination", "Social Support", "Community Connectedness", "Internalized Homophobia", "Felt Stigma", "Identity Centrality")
))) + theme_classic() + theme(axis.text.x=element_text(vjust = 0.5, angle = 15), plot.title = element_text(face = "bold", hjust = 0.5)) + labs(title = "Wave 3 Predictor Correlations") + scale_fill_gradient2(low = "#E64B35FF",
  mid = "white",
  high = "#4DBBD5FF") + guides(fill = FALSE)



```

Based on the correlation results, perhaps I should take out community engagement or identity centrality in the regression model

```{r}

#logR<-glmer(W3Q29D ~ W2EVERYDAY + W3EVERYDAY + W2SOCSUPPORT + W3SOCSUPPORT + W2CONNECTEDNESS + W3CONNECTEDNESS + W2INTERNALIZED + W3INTERNALIZED + W2FELTSTIGMA + W3FELTSTIGMA + W2IDCENTRAL + W3IDCENTRAL + (1| STUDYID), data = da37166.0007, family = binomial()) #mixed effect model, not sure I would need it summary(logR)

glm(W2Q29D ~ W1IDCENTRAL, data =da37166.0007, family = binomial)

da37166.0007_wave2_out <- da37166.0007 %>% 
  filter(W2Q29D=="1")

da37166.0007_wave3_out <- da37166.0007 %>% 
  filter(W3Q29D=="1")

count(da37166.0007_wave2_out$W2SEXMINID)

count(da37166.0007_wave3_out$W3SEXMINID)


count(da37166.0007$W1Q123B)

da37166.0007$W1Q123B<-as.numeric(da37166.0007$W1Q123B)

da37166.0007$W2Q106B<-as.numeric(da37166.0007$W2Q106B)

da37166.0007$W1Q124<-as.numeric(da37166.0007$W1Q124)

da37166.0007$W2Q107<-as.numeric(da37166.0007$W2Q107)

da37166.0007$W2Q29D<-as.numeric(da37166.0007$W2Q29D=="(1) Yes")

da37166.0007$W3Q29D<-as.numeric(da37166.0007$W3Q29D=="(1) Yes")

describe(da37166.0007$W2Q29D)

c(da37166.0007$W1Q123B)

logR_wave1<-glm(W2Q29D ~ W1AGE + W1Q123B + W1Q124 + W1EVERYDAY  + W1INTERNALIZED + W1GENDER + W1SEXMINID , data =da37166.0007, family = binomial) # + W1FELTSTIGMA  + W1SOCSUPPORT  + W1CONNECTEDNESS 

summary(logR_wave1)

tab_model(logR_wave1, show.est = TRUE)

logR_wave2<-glm(W3Q29D ~ W2AGE + W2Q106B + W2Q107 + W2EVERYDAY  + W2SOCSUPPORT  + W2CONNECTEDNESS  + W2INTERNALIZED  + W2FELTSTIGMA, data =da37166.0007, family = binomial)

vif(logR_wave2)

summary(logR_wave2)

tab_model(logR_wave2, show.est = TRUE)


logR_wave3<-glm(W3Q29D ~ W3EVERYDAY  + W3SOCSUPPORT  + W3CONNECTEDNESS  + W3INTERNALIZED  + W3FELTSTIGMA, data =da37166.0007, family = binomial)

summary(logR_wave3)

#Not sure if using wave 3 data to predict wave 3 outcome is legit

plot_model(logR_wave1, group.terms = c(1, 2, 2, 2, 2), colors=c("#4DBBD5FF","#E64B35FF"), show.values = TRUE, value.offset = .3, vline.color = "#1B191999", title = "Using Wave 1 Predictors to Predict Coming Out in Wave 2", type ="est", transform = NULL) + theme_classic() + theme(plot.title = element_text(face = "bold", hjust = 0.5)) + scale_x_discrete(labels=c("Felt Stigma", "Internalized Homophobia", "Community Connectedness","Social Support", "Everyday Discrimination"))

plot_model(logR_wave2, group.terms = c(1, 2, 2, 2, 2), colors=c("#4DBBD5FF","#E64B35FF"), show.values = TRUE, value.offset = .3, vline.color = "#1B191999", title = "Using Wave 2 Predictors to Predict Coming Out in Wave 3", type ="est", transform = NULL) + theme_classic() + theme(plot.title = element_text(face = "bold", hjust = 0.5)) + scale_x_discrete(labels=c("Felt Stigma", "Internalized Homophobia", "Community Connectedness","Social Support", "Everyday Discrimination"))

plot_model(logR_wave3, group.terms = c(1, 2, 2, 1, 2), colors=c("#4DBBD5FF","#E64B35FF"), show.values = TRUE, value.offset = .3, vline.color = "#1B191999", title = "Using Wave 3 Predictors to Predict Coming Out in Wave 3", type ="est", transform = NULL) + theme_classic() + theme(plot.title = element_text(face = "bold", hjust = 0.5)) + scale_x_discrete(labels=c("Felt Stigma", "Internalized Homophobia", "Community Connectedness","Social Support", "Everyday Discrimination"))




```
I changed all the x axis to log-odds. But by default it plots odds ratio, which I don't quite understand the benefit of it. Because the outcome was coded as (1)yes, (2)no. Greater scores of everyday discrimination means less encounters with discrimination. So the negative prediction of everyday discrimination means more daily discrimination, less likely to come out or less discrimination, more likely to come out. 


```{r}

path1 <-'W2Q29D ~ W1EVERYDAY  + W1SOCSUPPORT  + W1CONNECTEDNESS  + W1INTERNALIZED  + W1FELTSTIGMA

W1INTERNALIZED ~ W1FELTSTIGMA + W1EVERYDAY

W1SOCSUPPORT ~ W1CONNECTEDNESS

'


describe(da37166.0007$W2Q29D)


fit1<-sem(path1, data = da37166.0007)

summary(fit1, fit.measures=TRUE, standardized=T)

semPaths(fit1, "std", layout = "tree", edge.width = 1.5, edge.label.cex = 1.5, node.width=2, residuals=FALSE, nodeLabels = c("Coming\nOut", "Internalized\nHomophobia", "Social\nSupport", "Everyday\nDiscrimination", "Community\nConnectedness", "Felt\nStigma"), label.cex =1.2)


```

```{r}

path2 <-'W3Q29D ~ W2EVERYDAY  + W2SOCSUPPORT  + W2CONNECTEDNESS  + W2INTERNALIZED  + W2FELTSTIGMA

W2INTERNALIZED ~ W2FELTSTIGMA + W2EVERYDAY

W2SOCSUPPORT ~ W2CONNECTEDNESS

'

da37166.0007$W3Q29D<-as.numeric(da37166.0007$W3Q29D=="(1) Yes")

describe(da37166.0007$W3Q29D)

fit2<-sem(path2, data = da37166.0007)

summary(fit2, fit.measures=TRUE, standardized=T)

semPaths(fit2, "std", layout = "tree", edge.width = 1.5, edge.label.cex = 1.5, node.width=2, residuals=FALSE, nodeLabels = c("Coming\nOut", "Internalized\nHomophobia", "Social\nSupport", "Everyday\nDiscrimination", "Community\nConnectedness", "Felt\nStigma"), label.cex =1.2)


```

This is my first time building a path model. Obviously the model fit is pretty bad... And the diagram created by the semplot does not look pretty :(, the numbers overlapped. I guess this just isn't the best package to visualize path analysis results. 



```{r}

path3 <-'W3Q29D ~ W3EVERYDAY  + W3SOCSUPPORT  + W3CONNECTEDNESS  + W3INTERNALIZED  + W3FELTSTIGMA

W3INTERNALIZED ~ W3FELTSTIGMA + W3EVERYDAY

W3SOCSUPPORT ~ W3CONNECTEDNESS

'


describe(da37166.0007$W3Q29D)

fit3<-sem(path3, data = da37166.0007)

summary(fit3, fit.measures=TRUE, standardized=T)

semPaths(fit3, "std", layout = "tree", edge.width = 1.5, edge.label.cex = 1.5, node.width=2, residuals=FALSE, nodeLabels = c("Coming\nOut", "Internalized\nHomophobia", "Social\nSupport", "Everyday\nDiscrimination", "Community\nConnectedness", "Felt\nStigma"), label.cex =1.2)



```

I'm happy with the other plots I made, but the package that was used to make these semplots doesn't really allow me to express my creativity. 